FROM python:3.12-slim
WORKDIR /app

RUN apt-get update && apt-get install -y --no-install-recommends git && \
    rm -rf /var/lib/apt/lists/*

COPY pyproject.toml README.md ./
COPY prellm/ prellm/
COPY configs/ configs/
COPY tests/ tests/

# Install package + dev dependencies
RUN pip install --no-cache-dir . && \
    pip install --no-cache-dir "typer[all]>=0.15" && \
    pip install --no-cache-dir pytest pytest-asyncio pytest-mock pytest-cov ruff httpx

CMD ["python", "-m", "pytest", "tests/", "-v"]
